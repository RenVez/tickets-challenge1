<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ –ø–æ —Ç–∏–∫–µ—Ç–∞–º</title>
<style>
body { font-family: Arial,sans-serif; background:#1e1e2e; color:#eee; padding:20px; display:flex; flex-direction:column; align-items:center; }
h1 { color:#00ffae; }
#board { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:15px; width:90%; max-width:800px; margin-top:20px; }
.user { background:#2b2b3b; border-radius:10px; padding:15px; text-align:center; }
.count { font-size:2em; color:#00ffae; margin:10px 0; }
button { padding:8px 14px; border:none; border-radius:6px; background:#4a90e2; color:white; cursor:pointer; margin:5px; font-size:16px; }
button:disabled { background:#555; cursor:not-allowed; }
#timer { font-size:1.4em; margin:15px 0; }
#adminPanel { margin-top:30px; border-top:1px solid #444; padding-top:20px; }
input { padding:6px 10px; border-radius:5px; border:none; margin-right:5px; }
.winner { background:#ffd700; color:#000; }
</style>
</head>
<body>
<h1>–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ –ø–æ —Ç–∏–∫–µ—Ç–∞–º</h1>

<div>
<input id="usernameInput" placeholder="–í–∞—à–µ –∏–º—è">
<button id="joinBtn">–í–æ–π—Ç–∏</button>
</div>

<div id="timer">‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞—Ä—Ç–∞...</div>

<div id="board"></div>

<div id="adminPanel">
<h3>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h3>
<input type="text" id="adminPass" placeholder="–ü–∞—Ä–æ–ª—å">
<input type="text" id="targetUser" placeholder="–£—á–∞—Å—Ç–Ω–∏–∫">
<input type="number" id="duration" placeholder="–í—Ä–µ–º—è (—Å–µ–∫)">
<button id="startBtn">‚ñ∂ –ù–∞—á–∞—Ç—å</button>
<button id="stopBtn">‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
<button id="resetBtn">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let username = null;
const usernameInput = document.getElementById('usernameInput');
const joinBtn = document.getElementById('joinBtn');
const board = document.getElementById('board');
const timerEl = document.getElementById('timer');

const adminPanel = document.getElementById('adminPanel');
const adminPass = document.getElementById('adminPass');
const targetUser = document.getElementById('targetUser');
const durationInput = document.getElementById('duration');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const resetBtn = document.getElementById('resetBtn');

joinBtn.onclick = () => {
    username = usernameInput.value.trim();
    if(!username) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!");
    socket.emit('join', username);
    usernameInput.disabled = true;
    joinBtn.disabled = true;
};

socket.on('updateState', participants => {
    board.innerHTML = '';
    let maxCount = -1;
    for(let u in participants) {
        if(participants[u].count > maxCount) maxCount = participants[u].count;
    }
    for(let u in participants){
        const div = document.createElement('div');
        div.className = 'user';
        if(participants[u].count === maxCount && maxCount>0) div.classList.add('winner');
        div.innerHTML = `<div><strong>${u}</strong></div>
                         <div class="count">${participants[u].count}</div>`;
        if(u===username){
            const btn = document.createElement('button');
            btn.textContent = "+1 —Ç–∏–∫–µ—Ç";
            btn.disabled = !participants[u].running;
            btn.onclick = () => socket.emit('increment', username);
            div.appendChild(btn);
        }
        if(participants[u].running) {
            const t = document.createElement('div');
            t.textContent = `‚è± ${participants[u].remaining} —Å–µ–∫`;
            div.appendChild(t);
        }
        board.appendChild(div);
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ç–∞–π–º–µ—Ä (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç)
    let active = Object.values(participants).filter(p=>p.running);
    if(active.length>0) timerEl.textContent = `‚è± –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ –∏–¥—ë—Ç`;
    else timerEl.textContent = `üèÅ –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!`;
});

// –ê–¥–º–∏–Ω –∫–Ω–æ–ø–∫–∏
startBtn.onclick = () => {
    const pass = adminPass.value;
    const target = targetUser.value;
    const sec = parseInt(durationInput.value);
    if(!pass || !target || isNaN(sec) || sec<=0) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
    socket.emit('adminStart',{password:pass, username:target, seconds:sec});
};
stopBtn.onclick = () => {
    const pass = adminPass.value;
    const target = targetUser.value;
    if(!pass || !target) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞!");
    socket.emit('adminStop',{password:pass, username:target});
};
resetBtn.onclick = () => {
    const pass = adminPass.value;
    if(!pass) return alert("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å!");
    socket.emit('adminReset',pass);
};
</script>
</body>
</html>
